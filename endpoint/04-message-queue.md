# 消息队列端点

> 消息队列端点用于获取插件推送到服务器的消息

---

## 概述

消息队列端点提供了从服务器消息队列中获取插件推送消息的功能,支持按插件ID、优先级等条件过滤。

---

## 1. 获取插件消息端点

### 4.1 获取插件消息端点

#### `GET /plugin/messages`

**功能**: 获取插件推送到消息队列的消息

**查询参数**:
- `plugin_id` (可选): 插件ID,不提供则返回所有插件的消息
- `max_count` (可选): 最大返回数量 (1-1000,默认值来自配置)
- `priority_min` (可选): 最低优先级过滤 (只返回优先级 >= 此值的消息)

**认证要求**: 无

**响应格式**:
```json
{
  "messages": [
    {
      "id": "msg_001",
      "plugin_id": "plugin1",
      "content": "处理完成",
      "priority": 5,
      "timestamp": "2026-01-26T14:30:00.123456+08:00",
      "metadata": {}
    }
  ],
  "count": 1,
  "time": "2026-01-26T14:30:05.123456+08:00"
}
```

**字段说明**:
- `messages`: 消息数组
  - `id`: 消息ID
  - `plugin_id`: 发送消息的插件ID
  - `content`: 消息内容
  - `priority`: 优先级 (数值越大优先级越高)
  - `timestamp`: 消息时间戳
  - `metadata`: 附加元数据
- `count`: 返回的消息数量
- `time`: 响应时间戳

**实现细节**:
- 调用 `get_messages_from_queue()` 从消息队列获取消息
- 使用 `asyncio.to_thread()` 在线程中执行,避免阻塞
- 支持按插件ID和优先级过滤

**使用场景**:
- 轮询获取插件推送的通知
- 按优先级筛选重要消息
- 消息中心数据源

**代码位置**: `user_plugin_server.py:558-591`



---

## 总结

消息队列端点共 **1个**,无需认证:
- `/plugin/messages`: 获取插件推送的消息,支持多种过滤条件

主要用于轮询获取插件的通知消息和状态更新。
